<style>
    .col-xs-4 {
    width: 33.33333333%;
    float: left;
    position: relative;
    min-height: 1px;
    padding-right: 15px;
    padding-left: 15px;
}

body{
    font-size: 0.9rem;
font-weight: 400;
line-height: 1.5;
}

.terms {
    width: 100%;
    text-align: center;
    margin: 20px 0 0 0;
    box-sizing: border-box;
}
textarea {
    width: 100%;
    text-align: center;
    margin: 20px 0 0 0;
    box-sizing: border-box;
}

    </style>

<div class="container">
<div class="col-xs-12">
    
      <div id="invoice-wrap">
        
        <div class="row">
          <div class="col-xs-12">
            <h3 class="page-header">New INVOICE</h3>
          </div><!-- /.col -->
        </div>
    
        <div class="row invoice-info">
          <div class="col-xs-4 invoice-col">
            From
            <address>
                <input class="form-control" id= "1"/>
              <input class="form-control" id= "2"  placeholder="address line 1" />
              <input class="form-control" id= "3"  placeholder="address line 2" />
              <input class="form-control" id= "4"  placeholder="phone number" />
            </address>
          </div><!-- /.col -->
          <div class="col-xs-4 invoice-col">
            To
            <address>
                <input class="form-control" id= "5"/>
              <input class="form-control" id= "6"  placeholder="address line 1" />
              <input class="form-control" id= "7"  placeholder="address line 2" />
              <input class="form-control" id= "8"  placeholder="phone number" />
            </address>
          </div><!-- /.col -->
          <div class="col-xs-4 invoice-col ">
            <form class="form-horizontal">
    
              <div class="form-group">
                <div class="col-xs-4"><label>Invoice #</label></div>
                <div class="col-xs-8 invoice_num"><span id="invoice_number">//invoiceNo#</span></div>
              </div>
              <div class="col-xs-12"></div>
              <div class="form-group">
                <div class="col-xs-4"><label>date</label></div>
                <div class="col-xs-8"><input type="date" class="form-control" id="invoice-date"></div>
              </div>
    
              <div class="col-xs-12"></div>
              <div class="form-group">
                <div class="col-xs-4"></div>
                <div class="col-xs-8"></div>
              </div>
    
    
              <div class="col-xs-12"></div>
              <div class="form-group">
                <div class="col-xs-5 invoice_space"><label>Amount due</label></div>
                <div class="col-xs-7 invoice_space bold" style="text-align:center; padding-top:7px"><span class="due">875.00</span><span class="subtotal_currency"></span></div>
              </div>
            </form>
          </div><!-- /.col -->
        </div><!-- /.row -->
    
        <div class="row">
          <div class="col-xs-12 table-responsive">
            <hr>
            <table class="table table-hover" id="items">
              
          
              <thead>
                  <th class="item-name">Item</th>
                  <th class="description">Serial Number</th>
                  <th class="unit">Unit Cost</th>
                  <th class="quantity">Quantity</th>
                  <th class="units">Price</th>
                  <th class="no_print">Actions</th>
              </thead>
          
              <tbody>
                <tr class="item-row" id="row">
                  <td>
                      <select name="pid[]" id="product" onchange="changeSerial(this)" class="form-control item_name form-control-lg" value="Item #1" required>
                          
                          <option>Cable tube stripper 45-163</option>
                          <option>DEVISER Optical power meter AE270</option>
                          <option>DEVISER Optical light source LS310A</option>
                          <option>ELOIK Splicing machine ALK-88A</option>
                          <option>ELOIK Splicing machine ALK-A3</option>
                          <option>Manual Microscope 400x magnification</option>
                          <option>Tri-hole stripper</option>
                          
                      </select>
                      
                      
                  </td>
    
                  <td>
                      <select name="pid[]" disabled id="serial" class="form-control item_desc form-control-lg" value="Description" required>
                      <option>921</option>
                      <option>23306</option>
                      <option>23307</option>
                      <option>23309</option>
                      <option>23310</option>
                      <option>23311</option>
                      <option>23312</option>
                      <option>23313</option>
                      <option>23314</option>
                      <option>23317</option>
                      <option>23318</option>
                      <option>23319</option>
                      <option>23320</option>
                      <option>23321</option>
    
                      <option>1001670403</option>
                      <option>1001780403</option>
                      <option>1001870403</option>
                      <option>1001880403</option>
                      <option>1001890403</option>
                      <option>1001900403</option>
                      <option>1001910403</option>
                      <option>1001920403</option>
                      <option>1001940403</option>
    
                      <option>1001883250</option>
                      <option>1001903250</option>
                      <option>1001913250</option>
                      <option>1001953250</option>
                      <option>1002003250</option>
                      <option>1002063250</option>
                      <option>1002073250</option>
                      <option>1002093250</option>
                      <option>1002073250</option>
                      <option>1002093250</option>
                      <option>1002133250</option>
    
                      </select>
              
                  </td>
    
                  <td><input class="form-control cost" disabled id="price" onchange="findtotal(this)" value="650.00" /></td>
                  <td><input class="form-control qty" id="quantity" onchange="findtotal(this)" value="1" /></td>
                  <td class="price_td"><span class="price" id="totalRow">650.00</span><span class="subtotal_currency"></span></td>
                  <td class="delete_td"><a class="delete" onclick="deleteRow(this)" title="Remove row"><span class="fas fa-window-close"></span></a></td>
                </tr>
              
                <tr class="item-row" id="row">
                <td>
                <select name="pid[]" id="product" onchange="changeSerial(this)" class="form-control item_name form-control-lg" value="Item #2" required>
                    
                    <option>Cable tube stripper 45-163</option>
                    <option>DEVISER Optical power meter AE270</option>
                    <option>DEVISER Optical light source LS310A</option>
                    <option>ELOIK Splicing machine ALK-88A</option>
                    <option>ELOIK Splicing machine ALK-A3</option>
                    <option>Manual Microscope 400x magnification</option>
                    <option>Tri-hole stripper</option>
                    
                </select>
            </td>
    
            <td>
                <select name="pid[]" disabled id="serial" class="form-control item_desc form-control-lg" value="Description" required>
                <option>921</option>
                <option>23306</option>
                <option>23307</option>
                <option>23309</option>
                <option>23310</option>
                <option>23311</option>
                <option>23312</option>
                <option>23313</option>
                <option>23314</option>
                <option>23317</option>
                <option>23318</option>
                <option>23319</option>
                <option>23320</option>
                <option>23321</option>
    
                <option>1001670403</option>
                <option>1001780403</option>
                <option>1001870403</option>
                <option>1001880403</option>
                <option>1001890403</option>
                <option>1001900403</option>
                <option>1001910403</option>
                <option>1001920403</option>
                <option>1001940403</option>
    
                <option>1001883250</option>
                <option>1001903250</option>
                <option>1001913250</option>
                <option>1001953250</option>
                <option>1002003250</option>
                <option>1002063250</option>
                <option>1002073250</option>
                <option>1002093250</option>
                <option>1002073250</option>
                <option>1002093250</option>
                <option>1002133250</option>
    
                </select>
        
                
              </td>
                  <td><input class="form-control cost" disabled id="price" onchange="findtotal(this)" value="75.00" /></td>
                  <td><input class="form-control qty" id="quantity" onchange="findtotal(this)" value="3" /></td>
                  <td class="price_td"><span class="price" id="totalRow">225.00</span><span class="subtotal_currency"></span></td>
                  <td class="delete_td"><a class="delete" onclick="deleteRow(this)" title="Remove row"><span class="fas fa-window-close"></span></a></td>
                </tr>
              
                
              </tbody>
            </table>
          </div>
        </div>

        <div id="hiderow">
          <a id="addrow" class="btn btn-success btn-sm py-2 my-4" onclick="addRow()" title="Add a row"><span class="ti-plus"></span>  Add a row</a>
        </div>
    
        <div class="row">
          <div class="col-xs-6 col-xs-offset-6">
            <div class="table-responsive">
              <table class="table table-hover" id="totals">
                <tr>
                  <th style="width:50%">Subtotal:</th>
                  <td><span id="subtotal" >875.00</span><span class="subtotal_currency"></span></td>
                </tr>
                <tr>
                  <th>Tax:</th>
                  <td><input id="tax" onchange="totalInvoice()" class="form-control" value="0.00" /></td>
                </tr>
                <tr>
                  <th>Total:</th>
                  <td class="balance"><span class="due" id="invoice_total">875.00</span><span class="subtotal_currency"></span></td>
                  
                </tr>
              </table>
            </div>
          </div><!-- /.col -->    
        </div>
    
        <div class="row">
          <div class="col-xs-12 pull-left">
            <a class="btn btn-info btn-sm" id="invoice_button" onclick="showModel()" data-toggle="modal" data-target="#invoice_modal">Show Invoice</a>
            <a href="/" type="submit" name="commit" value="Submit Payment" class="btn btn btn-warning btn-sm" id="submit_invoice" data-disable-with="Submit Payment">Add Invoice</a>
          </div>
        </div>
    <div class="terms">
          <h5>Terms</h5>
          <textarea id="10">Payment terms: 100% Upon Delivery.</textarea>
        </div>
        
      </div>
      
    </div>
    
    <div class="modal" id="invoice_modal">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="container-fluid invoice_wrapper" id="print-me">
            </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" onclick="printDiv('print-me')">Print</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
</div>

<script>
  const deleteRow= (btn)=>{
          if (confirm("are you sure to delete row")) {
            const tr = btn.parentNode.parentNode
            const tbody = tr.parentNode
            console.log(tbody);
            tr.style.display ='none'
            
            } 
        }
  
  const addRow= () => {
    const div = document.createElement('tr');

  div.className = 'item-row';
  div.id = 'row'
  div.innerHTML = `<tr class="item-row">
                  <td>
                      <select name="pid[]" onchange="changeSerial(this)" id="product" class="form-control item_name form-control-lg" value="Item #1" required>
                          
                          <option>Cable tube stripper 45-163</option>
                          <option>DEVISER Optical power meter AE270</option>
                          <option>DEVISER Optical light source LS310A</option>
                          <option>ELOIK Splicing machine ALK-88A</option>
                          <option>ELOIK Splicing machine ALK-A3</option>
                          <option>Manual Microscope 400x magnification</option>
                          <option>Tri-hole stripper</option>
                          
                      </select>
                      
                      
                  </td>
    
                  <td>
                      <select name="pid[]" id="serial" disabled class="form-control item_desc form-control-lg" value="Description" required>
                      <option>921</option>
                      <option>23306</option>
                      <option>23307</option>
                      <option>23309</option>
                      <option>23310</option>
                      <option>23311</option>
                      <option>23312</option>
                      <option>23313</option>
                      <option>23314</option>
                      <option>23317</option>
                      <option>23318</option>
                      <option>23319</option>
                      <option>23320</option>
                      <option>23321</option>
    
                      <option>1001670403</option>
                      <option>1001780403</option>
                      <option>1001870403</option>
                      <option>1001880403</option>
                      <option>1001890403</option>
                      <option>1001900403</option>
                      <option>1001910403</option>
                      <option>1001920403</option>
                      <option>1001940403</option>
    
                      <option>1001883250</option>
                      <option>1001903250</option>
                      <option>1001913250</option>
                      <option>1001953250</option>
                      <option>1002003250</option>
                      <option>1002063250</option>
                      <option>1002073250</option>
                      <option>1002093250</option>
                      <option>1002073250</option>
                      <option>1002093250</option>
                      <option>1002133250</option>
    
                      </select>
              
                  </td>
    
                  <td><input class="form-control cost" disabled id="price" onchange="findtotal(this)" value="650.00" /></td>
                  <td><input class="form-control qty" id="quantity" onchange="findtotal(this)" value="0" /></td>
                  <td class="price_td"><span class="price" id="totalRow">0</span><span class="subtotal_currency"></span></td>
                  <td class="delete_td"><a class="delete" onclick="deleteRow(this)" title="Remove row"><span class="fas fa-window-close"></span></a></td>
                </tr>`;

  document.getElementById('items').appendChild(div);
  }

  
  const findtotal = (input)=>{
    const td = input.parentNode.parentNode
    console.log(td.querySelector('#price'));
    const price = td.querySelector('#price')
    const quantity = td.querySelector('#quantity')
    const totalRow = td.querySelector('#totalRow')
    const clc =Number(price.value)*Number(quantity.value)
    totalRow.textContent = clc
    console.log(clc);
    let sum = 0 
    allTotalRow =document.querySelectorAll('#totalRow')
    allTotalRow.forEach(element => {
      console.log(element.textContent);
      sum= sum + Number(element.textContent)
      console.log(sum);
    });
    const subTotal = document.getElementById('subtotal')  
    subTotal.textContent = sum
    const tax = document.getElementById('tax')
    const total_invoice = document.getElementById('invoice_total')
    total_invoice.textContent = sum + Number(tax.value)
    
  }

 const totalInvoice=()=>{
    const subTotal = document.getElementById('subtotal')  
    const tax = document.getElementById('tax')
    const total_invoice = document.getElementById('invoice_total')
    total_invoice.textContent = Number(subTotal.textContent) + Number(tax.value)
 } 

 const showModel = ()=>{
   const model = document.getElementById('invoice_modal')
   const print = document.querySelector('#print-me')
   print.innerHTML = `
   <div id="invoice-wrap">
        
        <div class="row">
          <div class="col-xs-12">
            <h3 class="page-header">INVOICE</h3>
          </div>
        </div>
    
        <div class="row invoice-info">
          <div class="col-xs-4 invoice-col">
            <label>From</label>
            <address>
             <p> ${document.getElementById(1).value}</p>
             <p> ${document.getElementById(2).value}</p>
             <p> ${document.getElementById(3).value} </p>
             <p> ${document.getElementById(4).value}</p>
            </address>
          </div>
          <div class="col-xs-4 invoice-col">
            <label>To</label>
            <address>
              <p> ${document.getElementById(5).value}</p>
              <p> ${document.getElementById(6).value}</p>
              <p> ${document.getElementById(7).value}</p>
              <p> ${document.getElementById(8).value}</p>
            </address>
          </div>
          <div class="col-xs-4 invoice-col ">
            <form class="form-horizontal">
              <div class="form-group">
                <div ><label>Invoice:</label></div>
                <div invoice_num"><span id="invoice_number"> 44 </span></div>
              </div>
              <div class="form-group">
                <div ><label>date</label></div>
                <div >${document.getElementById('invoice-date').value}</div>
              </div>
              <div class="form-group">
                <div class="col-xs-5 invoice_space"><label>Amount due</label></div>
                <div class="col-xs-7 invoice_space bold">${document.getElementById('invoice_total').textContent}</span></div>
              </div>
            </form>
          </div>
        </div>
    
        <div class="row">
          <div class="col-xs-12 table-responsive">
            <hr>
            <table border="1" style="text-align: center; vertical-align:middle; width:100%;"  id="items">
              <thead>
                  <th class="item-name" style="padding:5px">Item</th>
                  <th class="description">Serial Number</th>
                  <th class="unit">Unit Cost</th>
                  <th class="quantity">Quantity</th>
                  <th class="units">Price</th>
              </thead>
              <tbody>${getTableInfo()}<tbody>
              </table>
              </div>
              <div class="terms">
          <h5>Terms</h5>
          <textarea id="10">Payment terms: 100% Upon Delivery.</textarea>
        </div>
        
      </div>
   
   `
 }

 const getTableInfo =()=>{
   const rows = document.querySelectorAll('#row')
   console.log(rows);
   
   let s = ''
    rows.forEach(row => {
    if(row.style.display !== 'none'){
    s = s + `<tr>
              <td>${row.querySelector('#product').selectedOptions[0].textContent}</td>
              <td>${row.querySelector('#serial').selectedOptions[0].textContent}</td>
              <td>${row.querySelector('#price').value}</td>
              <td>${row.querySelector('#quantity').value}</td>
              <td>${row.querySelector('#totalRow').textContent}</td>
            </tr>`
          }
   });

   return s
   
 }

 const printDiv = ()=>{
   const print = document.getElementById('print-me')
   console.log('PDF printed');
   
//    const PDF = new jsPDF()
//    PDF.fromHTML(
//     print,
//     15,
//     15,{
//         'width':180,'elementHandlers':elementHandlers
//     }
// )
// window.open(PDF.output('datauristring'))
//    console.log(print);
 }
 const changeSerial=(product)=>{
  const row = product.parentNode.parentNode
  const serial = row.querySelector('#serial')
  serial.selectedIndex = product.selectedIndex

  
 }
</script>